# SentinelPi - Configuration des alertes
# ==================================================
#
# Niveaux de sÃ©vÃ©ritÃ© :
#   - info     : Information gÃ©nÃ©rale
#   - notice   : Ã€ noter
#   - warning  : Attention requise
#   - critical : Action immÃ©diate requise
#
# Canaux disponibles :
#   - telegram : Notifications via bot Telegram
#   - email    : Notifications par email
#   - webhook  : Appels HTTP vers une URL externe
#   - desktop  : Notifications bureau (si disponible)

alerting:
  enabled: true

  # ==================================================
  # AGRÃ‰GATION (anti-spam)
  # ==================================================
  aggregation:
    enabled: true
    # FenÃªtre d'agrÃ©gation en minutes
    window_minutes: 15
    # Maximum d'alertes par fenÃªtre avant agrÃ©gation
    max_alerts_per_window: 10
    # Envoyer un rÃ©sumÃ© si trop d'alertes
    send_summary: true

  # ==================================================
  # HEURES SILENCIEUSES (optionnel)
  # ==================================================
  quiet_hours:
    enabled: false
    # Ne pas envoyer d'alertes entre ces heures (sauf critical)
    start: "22:00"
    end: "07:00"
    # Les alertes critical ignorent les heures silencieuses
    bypass_for_critical: true

  # ==================================================
  # CANAUX DE NOTIFICATION
  # ==================================================
  channels:
    # --------------------------------------------------
    # TELEGRAM
    # --------------------------------------------------
    telegram:
      enabled: true
      # Token du bot (crÃ©Ã© via @BotFather)
      bot_token: "${TELEGRAM_BOT_TOKEN}"
      # ID du chat oÃ¹ envoyer (user ID ou group ID)
      chat_id: "${TELEGRAM_CHAT_ID}"
      # SÃ©vÃ©ritÃ© minimum pour ce canal
      min_severity: notice
      # DÃ©sactiver les aperÃ§us de liens
      disable_web_preview: false
      # Mode silencieux (pas de notification sonore)
      silent: false
      # Template du message (Markdown)
      format: |
        ğŸ”” *{severity_emoji} {severity}*

        ğŸ“° *{title}*

        ğŸ“Œ Source: {source_name}
        ğŸ• {published_at}

        {summary}

        ğŸ”— [Lire l'article]({url})

    # --------------------------------------------------
    # EMAIL
    # --------------------------------------------------
    email:
      enabled: false
      # Configuration SMTP
      smtp_host: "smtp.gmail.com"
      smtp_port: 587
      use_tls: true
      # Authentification
      username: "${EMAIL_USER}"
      password: "${EMAIL_PASSWORD}"
      # Adresses
      from_address: "sentinelpi@example.com"
      from_name: "SentinelPi"
      to_addresses:
        - "analyst@example.com"
      # SÃ©vÃ©ritÃ© minimum pour ce canal
      min_severity: warning
      # Template du sujet
      subject_template: "[SentinelPi] {severity_emoji} {severity}: {title}"
      # Inclure le contenu complet
      include_full_content: true

    # --------------------------------------------------
    # WEBHOOK
    # --------------------------------------------------
    webhook:
      enabled: false
      # URL de destination
      url: "${WEBHOOK_URL}"
      # MÃ©thode HTTP
      method: POST
      # Headers personnalisÃ©s
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer ${WEBHOOK_TOKEN}"
      # SÃ©vÃ©ritÃ© minimum
      min_severity: notice
      # Timeout en secondes
      timeout: 30
      # Retry en cas d'Ã©chec
      max_retries: 3
      # Payload JSON (variables disponibles : item, alert, source)
      # payload_template: |
      #   {
      #     "text": "{title}",
      #     "severity": "{severity}",
      #     "url": "{url}",
      #     "source": "{source_name}"
      #   }

    # --------------------------------------------------
    # DESKTOP (notifications systÃ¨me)
    # --------------------------------------------------
    desktop:
      enabled: false
      min_severity: warning
      # DurÃ©e d'affichage en secondes
      timeout: 10

  # ==================================================
  # RÃˆGLES DE ROUTAGE
  # ==================================================
  # Permet de personnaliser les canaux par catÃ©gorie ou tags

  rules:
    # Alertes concurrents -> Telegram uniquement
    - category: "concurrents"
      min_severity: info
      channels: [telegram]

    # Alertes presse importantes -> Telegram + Email
    - category: "presse"
      min_severity: warning
      channels: [telegram, email]

    # Alertes avec tag "critique" -> Tous les canaux
    - tags: ["critique", "urgent"]
      min_severity: info
      channels: [telegram, email, webhook]

    # Alertes tech -> Seulement Telegram
    - category: "tech"
      min_severity: notice
      channels: [telegram]

  # ==================================================
  # EMOJIS PAR SÃ‰VÃ‰RITÃ‰
  # ==================================================
  severity_emojis:
    info: "â„¹ï¸"
    notice: "ğŸ“¢"
    warning: "âš ï¸"
    critical: "ğŸš¨"
