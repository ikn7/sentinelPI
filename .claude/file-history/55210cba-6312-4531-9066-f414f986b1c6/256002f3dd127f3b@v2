<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .period {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .header .generated {
            font-size: 0.9em;
            opacity: 0.7;
            margin-top: 10px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .stat-card.critical .value {
            color: var(--danger);
        }

        /* Sections */
        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Alerts */
        .alert-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-item.critique {
            background: #fdeaea;
            border-color: var(--danger);
        }

        .alert-item.important {
            background: #fef5e7;
            border-color: var(--warning);
        }

        .alert-item.attention {
            background: #fef9e7;
            border-color: #f1c40f;
        }

        .alert-item.info {
            background: #e8f4fd;
            border-color: var(--secondary);
        }

        .alert-item .title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .alert-item .meta {
            font-size: 0.85em;
            color: #666;
            margin-top: 8px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: var(--light);
            font-weight: 600;
            color: var(--primary);
        }

        tr:hover {
            background: #f9f9f9;
        }

        /* Deadlines */
        .deadline-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .deadline-days {
            min-width: 80px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            padding: 10px;
            border-radius: 8px;
            margin-right: 15px;
        }

        .deadline-days.critical {
            background: var(--danger);
            color: white;
        }

        .deadline-days.warning {
            background: var(--warning);
            color: white;
        }

        .deadline-days.normal {
            background: var(--success);
            color: white;
        }

        .deadline-content {
            flex: 1;
        }

        .deadline-content .title {
            font-weight: 600;
        }

        .deadline-content .subtitle {
            font-size: 0.85em;
            color: #666;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-primary { background: var(--primary); color: white; }
        .badge-success { background: var(--success); color: white; }
        .badge-warning { background: var(--warning); color: white; }
        .badge-danger { background: var(--danger); color: white; }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }

        /* Links */
        a {
            color: var(--secondary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            .container {
                max-width: 100%;
            }
            .section {
                break-inside: avoid;
            }
        }

        @page {
            size: A4;
            margin: 2cm;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üìä {{ title }}</h1>
            <div class="period">
                Du {{ period_start|format_date }} au {{ period_end|format_date }}
            </div>
            <div class="generated">
                G√©n√©r√© le {{ generated_at|format_date('%d/%m/%Y √† %H:%M') }}
            </div>
        </header>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="value">{{ stats.competitors_count }}</div>
                <div class="label">Concurrents surveill√©s</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ stats.total_alerts }}</div>
                <div class="label">Alertes cette semaine</div>
            </div>
            <div class="stat-card critical">
                <div class="value">{{ stats.critical_alerts }}</div>
                <div class="label">Alertes critiques</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ stats.new_job_offers }}</div>
                <div class="label">Nouvelles offres</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ stats.new_regulations }}</div>
                <div class="label">Nouveaux textes</div>
            </div>
        </div>

        <!-- Critical Alerts -->
        {% set critical_alerts = alerts|selectattr('severite', 'equalto', 'critique')|list %}
        {% if critical_alerts %}
        <section class="section">
            <h2>üö® Alertes critiques</h2>
            {% for alert in critical_alerts %}
            <div class="alert-item critique">
                <div class="title">{{ alert.titre }}</div>
                <div>{{ alert.message|truncate_text(200) }}</div>
                <div class="meta">
                    {% if alert.competitor %}üè¢ {{ alert.competitor }} ‚Ä¢ {% endif %}
                    üìÖ {{ alert.created_at|format_date('%d/%m/%Y %H:%M') }}
                    {% if alert.source_url %} ‚Ä¢ <a href="{{ alert.source_url }}">Source</a>{% endif %}
                </div>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <!-- Upcoming Deadlines -->
        {% if deadlines %}
        <section class="section">
            <h2>‚è∞ √âch√©ances √† venir</h2>
            {% for deadline in deadlines[:10] %}
            <div class="deadline-item">
                <div class="deadline-days {{ deadline.urgency }}">
                    {{ deadline.days_until }}j
                </div>
                <div class="deadline-content">
                    <div class="title">{{ deadline.description }}</div>
                    <div class="subtitle">{{ deadline.regulation_titre|truncate_text(80) }}</div>
                </div>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <!-- Competitors Summary -->
        {% if competitors %}
        <section class="section">
            <h2>üè¢ R√©sum√© des concurrents</h2>
            <table>
                <thead>
                    <tr>
                        <th>Entreprise</th>
                        <th>SIREN</th>
                        <th>Alertes</th>
                        <th>Offres</th>
                        <th>CA</th>
                        <th>Effectif</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comp in competitors %}
                    <tr>
                        <td><strong>{{ comp.nom }}</strong></td>
                        <td>{{ comp.siren }}</td>
                        <td>
                            {% if comp.alerts_count > 0 %}
                            <span class="badge badge-warning">{{ comp.alerts_count }}</span>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td>{{ comp.jobs_count or '-' }}</td>
                        <td>{{ comp.last_ca|format_currency if comp.last_ca else '-' }}</td>
                        <td>{{ comp.last_effectif or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        {% endif %}

        <!-- Recent Regulations -->
        {% if regulations %}
        <section class="section">
            <h2>üìú Nouveaux textes r√©glementaires</h2>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Titre</th>
                        <th>Date</th>
                        <th>Source</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reg in regulations[:15] %}
                    <tr>
                        <td><span class="badge badge-primary">{{ reg.type }}</span></td>
                        <td>
                            <a href="{{ reg.url }}">{{ reg.titre|truncate_text(60) }}</a>
                        </td>
                        <td>{{ reg.date_publication|format_date if reg.date_publication else 'N/A' }}</td>
                        <td>{{ reg.source }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        {% endif %}

        <!-- All Alerts -->
        {% if alerts %}
        <section class="section">
            <h2>üîî Toutes les alertes</h2>
            {% for alert in alerts[:30] %}
            <div class="alert-item {{ alert.severite }}">
                <div class="title">
                    <span class="badge badge-{% if alert.severite == 'critique' %}danger{% elif alert.severite == 'important' %}warning{% else %}primary{% endif %}">
                        {{ alert.severite }}
                    </span>
                    {{ alert.titre }}
                </div>
                <div>{{ alert.message|truncate_text(150) }}</div>
                <div class="meta">
                    {{ alert.categorie }} ‚Ä¢
                    {% if alert.competitor %}üè¢ {{ alert.competitor }} ‚Ä¢ {% endif %}
                    üìÖ {{ alert.created_at|format_date('%d/%m %H:%M') }}
                </div>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <!-- Footer -->
        <footer class="footer">
            <p>StratWatch - Plateforme de veille strat√©gique</p>
            <p>Rapport g√©n√©r√© automatiquement</p>
        </footer>
    </div>
</body>
</html>
